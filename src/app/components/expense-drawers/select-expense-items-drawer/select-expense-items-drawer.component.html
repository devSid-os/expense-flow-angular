<!-- SELECT EXPENSE ITEMS DRAWER -->
<p-drawer 
    (onHide)='closeDrawer();' 
    position='right' 
    [visible]='isDrawerOpen()' 
    [closable]='false'
    id='addExpenseDrawer'
>
    <div class="w-full h-full flex flex-col bg-gray-50">
        <!-- Header -->
        <div class='p-4 bg-white border-b border-gray-200'>
            <div class='flex items-center justify-between'>
                <button 
                    (click)='closeDrawer();' 
                    type='button'
                    class='w-8 h-8 rounded-full hover:bg-gray-100 text-gray-600 transition-colors flex items-center justify-center'
                >
                    <i class='fa-solid fa-arrow-left'></i>
                </button>
                <h2 class='text-lg font-semibold text-gray-900'>Select Items</h2>
                <button 
                    (click)='closeAllDrawers();' 
                    type='button'
                    class='w-8 h-8 rounded-full hover:bg-gray-100 text-gray-600 transition-colors flex items-center justify-center'
                >
                    <i class='fa-solid fa-times'></i>
                </button>
            </div>
        </div>

        <!-- Content -->
        <div class='flex-1 overflow-y-auto'>
            <div class="p-4 space-y-4">
                
                <!-- Search Bar -->
                <div class='flex items-center border border-gray-300 bg-white px-2 rounded-md'>
                    <i class='fa-solid fa-magnifying-glass text-gray-400 text-md'></i>
                    <input 
                        type='search' 
                        pInputText 
                        placeholder='Search items...' 
                        style="border: 0!important;outline: none;"
                        class='w-full pl-10 pr-4 py-2 rounded-lg border-0'
                    />
                </div>

                <!-- Add New Item Section -->
                <div class='bg-white border border-gray-200 rounded-lg overflow-hidden'>
                    <p-accordion [value]='1'>
                        <p-accordion-panel [value]='0'>
                            <p-accordion-header>
                                <button 
                                    type='button'
                                    class='w-full text-left py-4 px-3 text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors flex items-center gap-2'
                                    style="padding: .75rem!important;"
                                >
                                    <i class='fa-solid fa-plus text-gray-600'></i>
                                    <span>Add New Item</span>
                                </button>
                            </p-accordion-header>
                            <p-accordion-content>
                                <form 
                                    (ngSubmit)='addNewExpenseItem();' 
                                    class='p-4 space-y-3 bg-gray-50'
                                    [formGroup]='addItemForm'
                                >
                                    <!-- Item Name -->
                                    <div class='flex flex-col gap-1.5'>
                                        <label class='text-sm font-medium text-gray-700'>Item Name</label>
                                        <input 
                                            autocomplete='off' 
                                            placeholder='Enter item name'
                                            type='text' 
                                            formControlName='name' 
                                            pInputText
                                            class='w-full'
                                        />
                                        <ng-container *ngIf='addItemForm.get("name")?.dirty'>
                                            <p-message 
                                                *ngIf='addItemForm.get("name")?.hasError("required")'
                                                variant='simple' 
                                                severity='error'
                                            >
                                                Item name is required
                                            </p-message>
                                        </ng-container>
                                    </div>

                                    <!-- Price -->
                                    <div class='flex flex-col gap-1.5'>
                                        <label class='text-sm font-medium text-gray-700'>Price</label>
                                        <div class='relative'>
                                            <i class='fa-solid fa-indian-rupee-sign absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm'></i>
                                            <input 
                                                formControlName='price' 
                                                autocomplete='off' 
                                                type='number'
                                                pInputText 
                                                placeholder='Enter price' 
                                                class='w-full pl-10'
                                            />
                                        </div>
                                        <ng-container *ngIf='addItemForm.get("price")?.dirty'>
                                            <p-message
                                                *ngIf='!addItemForm.get("price")?.hasError("pattern") && addItemForm.get("price")?.hasError("required")'
                                                variant='simple' 
                                                severity='error'
                                            >
                                                Price is required
                                            </p-message>
                                            <p-message
                                                *ngIf='addItemForm.get("price")?.hasError("pattern")'
                                                variant='simple' 
                                                severity='error'
                                            >
                                                Enter a valid price (max 2 decimal places)
                                            </p-message>
                                        </ng-container>
                                    </div>
                                    
                                    <button 
                                        type='submit' 
                                        class='w-full rounded-lg text-sm py-2.5 font-semibold text-white bg-gray-900 hover:bg-gray-800 transition-colors disabled:opacity-50'
                                        [disabled]='addItemForm.invalid'
                                    >
                                        <i class="fa-solid fa-plus mr-2"></i>Add Item
                                    </button>
                                </form>
                            </p-accordion-content>
                        </p-accordion-panel>
                    </p-accordion>
                </div>

                <!-- Items List -->
                <ng-container [ngSwitch]='editExpenseDrawerOpen()'>
                    <ng-container *ngSwitchCase='true'>
                        <app-items-list 
                            (onEditItem)='onEditExpenseItem($event);'
                            [itemsCartArray]='editItemsCartArray()'
                            [items]='items()' 
                            [itemsCart]='editItemsCart()'
                        ></app-items-list>
                    </ng-container>
                    <ng-container *ngSwitchCase='false'>
                        <app-items-list 
                            (onEditItem)='onEditExpenseItem($event);'
                            [itemsCartArray]='itemsCartArray()' 
                            [items]='items()'
                            [itemsCart]='itemsCart()'
                        ></app-items-list>
                    </ng-container>
                </ng-container>
            </div>
        </div>

        <!-- Footer with Cart Summary -->
        <ng-container [ngSwitch]='editExpenseDrawerOpen()'>
            <div 
                *ngSwitchCase='true'
                class='p-4 bg-white border-t border-gray-200'
                [class.hidden]='!editItemsCartArray().length'
            >
                <div class='flex justify-between items-center'>
                    <div>
                        <p class='text-xs text-gray-500 font-medium'>{{editItemsCartArray().length}} Items Selected</p>
                        <p class='text-2xl font-bold text-gray-900 mt-1'>
                            <i class='fa-solid fa-indian-rupee-sign text-xl'></i>{{editCartTotalAmount()}}
                        </p>
                    </div>
                    <button 
                        (click)='closeDrawer()' 
                        type='button'
                        class='rounded-lg text-sm py-3 px-6 font-semibold text-white bg-gray-900 hover:bg-gray-800 transition-colors'
                    >
                        Continue
                    </button>
                </div>
            </div>

            <div 
                *ngSwitchCase='false'
                class='p-4 bg-white border-t border-gray-200'
                [class.hidden]='!itemsCartArray().length'
            >
                <div class='flex justify-between items-center'>
                    <div>
                        <p class='text-xs text-gray-500 font-medium'>{{itemsCartArray().length}} Items Selected</p>
                        <p class='text-2xl font-bold text-gray-900 mt-1'>
                            <i class='fa-solid fa-indian-rupee-sign text-xl'></i>{{cartTotalAmount()}}
                        </p>
                    </div>
                    <button 
                        (click)='closeDrawer()' 
                        type='button'
                        class='rounded-lg text-sm py-3 px-6 font-semibold text-white bg-gray-900 hover:bg-gray-800 transition-colors'
                    >
                        Continue
                    </button>
                </div>
            </div>
        </ng-container>
    </div>
</p-drawer>

<p-toast position='bottom-center' />

<!-- EDIT ITEM DIALOG -->
<p-dialog 
    header='Edit Item' 
    [modal]='true' 
    [(visible)]='showEditItemDialog' 
    [style]='{ width: "25rem" }'
    styleClass="modern-dialog"
>
    <form [formGroup]='editItemForm' class='space-y-4'>
        <div class='flex flex-col gap-1.5'>
            <label for='itemName' class='text-sm font-medium text-gray-700'>Item Name</label>
            <input 
                pInputText 
                formControlName='name' 
                id='itemName' 
                autocomplete='off'
                type='text'
                placeholder='Enter item name'
                class='w-full'
            />
        </div>
        
        <div class='flex flex-col gap-1.5'>
            <label for='itemPrice' class='text-sm font-medium text-gray-700'>Price</label>
            <input 
                pInputText 
                formControlName='price' 
                id='itemPrice' 
                autocomplete='off' 
                type='number'
                placeholder='Enter price'
                class='w-full'
            />
        </div>
        
        <div class='flex justify-end gap-2 pt-4'>
            <button 
                [disabled]='loading()' 
                type='button'
                (click)='closeEditExpenseModal();'
                class='px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50'
            >
                Cancel
            </button>
            <button 
                [disabled]='loading() || editItemForm.invalid' 
                type='submit'
                (click)='editUserExpenseItem();'
                class='px-4 py-2 text-sm font-medium text-white bg-gray-900 rounded-lg hover:bg-gray-800 transition-colors disabled:opacity-50'
            >
                <i class="fa-solid fa-check mr-1.5"></i>Save Changes
            </button>
        </div>
    </form>
</p-dialog>